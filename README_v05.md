# æ©‹æ¢ç¶­æŒç®¡ç† Agentic Clustering v0.5

## æ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€å±±å£çœŒã®æ©‹æ¢ç¶­æŒç®¡ç†ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€**è‡ªå·±æ”¹å–„å‹ï¼ˆAgenticï¼‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°**ã‚’é©ç”¨ã—ã€è£œä¿®å„ªå…ˆåº¦ã®é«˜ã„æ©‹æ¢ç¾¤ã‚’è‡ªå‹•çš„ã«ç‰¹å®šã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### v0.5ã®ä¸»è¦æ”¹å–„ç‚¹

1. **åœ°ç†ç©ºé–“ç‰¹å¾´é‡ã®è¿½åŠ ** (13ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ )
   - æ¡ä¸‹æ²³å·ï¼ˆunder_riverï¼‰
   - æµ·å²¸ç·šã‹ã‚‰ã®è·é›¢ï¼ˆdistance_to_coast_kmï¼‰

2. **Agenticãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æœ€é©åŒ–**
   - GMMç„¡åŠ¹åŒ–ï¼ˆK-Meansã¨é¡ä¼¼ã‚¹ã‚³ã‚¢ã®ãŸã‚ï¼‰
   - DBSCANé™¤å¤–ãƒ«ãƒ¼ãƒ«ï¼ˆ50ã‚¯ãƒ©ã‚¹ã‚¿è¶…éæ™‚ï¼‰
   - HDBSCANè‡ªå‹•èµ·å‹•ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

3. **æ¬¡å…ƒå‰Šæ¸›ã®æ”¹å–„**
   - t-SNE/UMAPã®æ­£å¸¸å‹•ä½œåŒ–
   - ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—é–¾å€¤ã®èª¿æ•´ï¼ˆ0.10ï¼‰
   - è‡ªå‹•çš„ãªæœ€é©æ‰‹æ³•é¸æŠ

---

## ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Agenticãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒ

```mermaid
flowchart TD
    Start([é–‹å§‹]) --> Load[ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿<br/>4292æ©‹æ¢]
    Load --> Preprocess[å‰å‡¦ç†<br/>13ç‰¹å¾´é‡æŠ½å‡º]
    
    Preprocess --> Standardize[ç‰¹å¾´é‡æ¨™æº–åŒ–]
    
    Standardize --> KMeans[KMeansåˆå›å®Ÿè¡Œ<br/>k=2-28æ¢ç´¢]
    KMeans --> EvalKMeans{å“è³ªè©•ä¾¡<br/>ç·åˆã‚¹ã‚³ã‚¢60ä»¥ä¸Š?}
    
    EvalKMeans -->|Yes| PCA1[PCAå®Ÿè¡Œ]
    EvalKMeans -->|No| AltClustering[ä»£æ›¿ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°è©¦è¡Œ]
    
    AltClustering --> DBSCAN[DBSCANå®Ÿè¡Œ<br/>eps/min_samplesæ¢ç´¢]
    DBSCAN --> EvalDBSCAN{DBSCANè©•ä¾¡}
    
    EvalDBSCAN --> CheckClusters{ã‚¯ãƒ©ã‚¹ã‚¿æ•°50ä»¥ä¸‹?}
    CheckClusters -->|No| TriggerHDBSCAN[HDBSCANè‡ªå‹•èµ·å‹•<br/>ç›®æ¨™50ã‚¯ãƒ©ã‚¹ã‚¿]
    CheckClusters -->|Yes| CompareAll[æ‰‹æ³•æ¯”è¼ƒ]
    TriggerHDBSCAN --> HDBSCAN[HDBSCANå®Ÿè¡Œ<br/>min_cluster_sizeæ¢ç´¢]
    
    HDBSCAN --> CompareAll
    CompareAll --> FilterDBSCAN{DBSCANã‚¯ãƒ©ã‚¹ã‚¿æ•°50è¶…?}
    FilterDBSCAN -->|Yes| ExcludeDBSCAN[DBSCANé™¤å¤–]
    FilterDBSCAN -->|No| SelectBest[æœ€é«˜ã‚¹ã‚³ã‚¢é¸æŠ]
    ExcludeDBSCAN --> SelectBest
    
    SelectBest --> BestMethod[æœ€é©æ‰‹æ³•æ±ºå®š<br/>HDBSCAN/KMeans]
    
    PCA1 --> BestMethod
    BestMethod --> PCA2[PCAå®Ÿè¡Œ<br/>n_components=2]
    PCA2 --> EvalPCA[ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—è©•ä¾¡]
    
    EvalPCA --> CheckOverlap{ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—<br/>ã‚¹ã‚³ã‚¢0.10ä»¥ä¸‹?}
    CheckOverlap -->|Yes| UsePCA[PCAæ¡ç”¨]
    CheckOverlap -->|No| AltDimRed[ä»£æ›¿æ¬¡å…ƒå‰Šæ¸›]
    
    AltDimRed --> TSNE[t-SNEå®Ÿè¡Œ<br/>perplexityæ¢ç´¢]
    TSNE --> UMAP[UMAPå®Ÿè¡Œ<br/>n_neighborsæ¢ç´¢]
    UMAP --> CompareDimRed[æ¬¡å…ƒå‰Šæ¸›æ¯”è¼ƒ]
    
    CompareDimRed --> SelectDimRed[æœ€é©æ‰‹æ³•é¸æŠ<br/>æœ€å°ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—]
    
    UsePCA --> Visualize[å¯è¦–åŒ–]
    SelectDimRed --> Visualize
    Visualize --> Output[çµæœå‡ºåŠ›<br/>CSV/PNG/TXT]
    Output --> End([çµ‚äº†])
    
    classDef processClass fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef decisionClass fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef agenticClass fill:#f3e5f5,stroke:#4a148c,stroke-width:3px
    classDef outputClass fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    
    class KMeans,DBSCAN,HDBSCAN,PCA2,TSNE,UMAP processClass
    class EvalKMeans,EvalDBSCAN,CheckClusters,FilterDBSCAN,CheckOverlap decisionClass
    class TriggerHDBSCAN,ExcludeDBSCAN,SelectBest,SelectDimRed agenticClass
    class Output outputClass
```

### Agenticã®è‡ªå¾‹åˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆ

| # | åˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆ | æ¡ä»¶ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|---|------------|------|----------|
| 1 | ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°å“è³ª | ç·åˆã‚¹ã‚³ã‚¢ < 60 | ä»£æ›¿æ‰‹æ³•ï¼ˆDBSCAN/HDBSCANï¼‰è©¦è¡Œ |
| 2 | DBSCANã‚¯ãƒ©ã‚¹ã‚¿æ•° | ã‚¯ãƒ©ã‚¹ã‚¿æ•° > 50 | HDBSCANè‡ªå‹•èµ·å‹• |
| 3 | DBSCANæ¡ç”¨å¯å¦ | ã‚¯ãƒ©ã‚¹ã‚¿æ•° > 50 | å€™è£œã‹ã‚‰é™¤å¤– |
| 4 | æ¬¡å…ƒå‰Šæ¸›ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ— | ã‚¹ã‚³ã‚¢ > 0.10 | ä»£æ›¿æ‰‹æ³•ï¼ˆt-SNE/UMAPï¼‰è©¦è¡Œ |

---

## ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ13ç‰¹å¾´é‡ï¼‰

### åŸºæœ¬ç‰¹å¾´é‡ï¼ˆ6é …ç›®ï¼‰

| ç‰¹å¾´é‡ | èª¬æ˜ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ |
|--------|------|-------------|
| `bridge_age` | æ¶è¨­å¹´ã‹ã‚‰ã®çµŒéå¹´æ•° | æ©‹æ¢ãƒ‡ãƒ¼ã‚¿ |
| `condition_score` | å¥å…¨åº¦ã‚¹ã‚³ã‚¢ï¼ˆ0-3ï¼‰ | æ©‹æ¢ãƒ‡ãƒ¼ã‚¿ |
| `maintenance_priority` | ç¶­æŒç®¡ç†å„ªå…ˆåº¦ | æ©‹æ¢ãƒ‡ãƒ¼ã‚¿ |
| `future_burden_ratio` | å°†æ¥è² æ‹…æ¯”ç‡ï¼ˆ%ï¼‰ | è²¡æ”¿åŠ›æŒ‡æ•°ãƒ‡ãƒ¼ã‚¿ |
| `aging_rate` | é«˜é½¢åŒ–ç‡ï¼ˆ%ï¼‰ | äººå£çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ |
| `fiscal_index` | è²¡æ”¿åŠ›æŒ‡æ•° | è²¡æ”¿åŠ›æŒ‡æ•°ãƒ‡ãƒ¼ã‚¿ |

### æ‹¡å¼µç‰¹å¾´é‡ï¼ˆ5é …ç›®ï¼‰

| ç‰¹å¾´é‡ | èª¬æ˜ | è¨ˆç®—æ–¹æ³• |
|--------|------|---------|
| `structure_category` | æ§‹é€ å½¢å¼ã‚«ãƒ†ã‚´ãƒªï¼ˆ0-4ï¼‰ | RCç³»/PCç³»/é‹¼æ©‹/ãƒœãƒƒã‚¯ã‚¹/ãã®ä»– |
| `bridge_area` | æ©‹é¢ç©ï¼ˆmÂ²ï¼‰ | æ©‹é•· Ã— å¹…å“¡ |
| `emergency_route` | ç·Šæ€¥è¼¸é€é“è·¯ãƒ•ãƒ©ã‚°ï¼ˆ0/1ï¼‰ | è·¯ç·šåã‹ã‚‰ã®æŠ½å‡º |
| `overpass` | è·¨ç·šæ©‹ãƒ•ãƒ©ã‚°ï¼ˆ0/1ï¼‰ | æ©‹æ¢åã‹ã‚‰ã®æŠ½å‡º |
| `repair_year_normalized` | æœ€æ–°è£œä¿®å¹´åº¦ã®æ­£è¦åŒ–å€¤ | MinMaxã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° |

### åœ°ç†ç©ºé–“ç‰¹å¾´é‡ï¼ˆ2é …ç›®ï¼‰âœ¨ NEW

| ç‰¹å¾´é‡ | èª¬æ˜ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | è¨ˆç®—æ–¹æ³• |
|--------|------|------------|---------|
| `under_river` | æ¡ä¸‹æ²³å·ãƒ•ãƒ©ã‚°ï¼ˆ0/1ï¼‰ | å›½åœŸæ•°å€¤æƒ…å ±ï¼ˆæ²³å·ãƒ‡ãƒ¼ã‚¿ï¼‰ | UTMæŠ•å½±ã§50mãƒãƒƒãƒ•ã‚¡åˆ¤å®š |
| `distance_to_coast_km` | æµ·å²¸ç·šã‹ã‚‰ã®è·é›¢ï¼ˆkmï¼‰ | å›½åœŸæ•°å€¤æƒ…å ±ï¼ˆæµ·å²¸ç·šãƒ‡ãƒ¼ã‚¿ï¼‰ | æ¸¬åœ°ç·šè·é›¢è¨ˆç®— |

#### åœ°ç†ç©ºé–“ç‰¹å¾´é‡ã®å®Ÿè£…è©³ç´°

**åº§æ¨™ç³»ã®æ‰±ã„**:
- å…¥åŠ›: WGS84 (EPSG:4326)
- è¨ˆç®—: UTM Zone 53N (EPSG:32653)
- ShapefileãŒåº§æ¨™ç³»æƒ…å ±ã‚’æŒãŸãªã„å ´åˆã€è‡ªå‹•çš„ã«EPSG:4326ã‚’è¨­å®š

**æ²³å·åˆ¤å®š**:
```python
# UTMæŠ•å½±ã§50mãƒãƒƒãƒ•ã‚¡
bridge_point_proj = bridge_point.to_crs("EPSG:32653")
river_buffer = river_data_proj.buffer(50)  # 50m
has_river = bridge_point_proj.within(river_buffer.unary_union)
```

**æµ·å²¸ç·šè·é›¢**:
```python
# æ¸¬åœ°ç·šè·é›¢ï¼ˆWGS84åº§æ¨™ç³»ã§è¨ˆç®—ï¼‰
distances = coastline.geometry.apply(
    lambda geom: bridge_point.distance(geom)
)
distance_m = distances.min() * 111000  # åº¦â†’ãƒ¡ãƒ¼ãƒˆãƒ«æ¦‚ç®—
distance_km = distance_m / 1000
```

**å®Ÿè¡Œçµæœ**:
- æ¡ä¸‹æ²³å·ã‚ã‚Š: 2,447ä»¶ (57.0%)
- æµ·å²¸ç·šè·é›¢ç¯„å›²: 0.00ã€œ30.09km
- æµ·å²¸ç·šè·é›¢å¹³å‡: 9.19km

---

## ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•

### 1. KMeansï¼ˆåˆå›å®Ÿè¡Œï¼‰

- **æ¢ç´¢ç¯„å›²**: k=2ã€œ28
- **è©•ä¾¡æŒ‡æ¨™**: ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢
- **çµæœ**: k=27ãŒæœ€é©ï¼ˆã‚¹ã‚³ã‚¢0.1615ï¼‰
- **ç·åˆè©•ä¾¡**: 43.95/100 â†’ ä»£æ›¿æ‰‹æ³•è©¦è¡Œ

### 2. DBSCANï¼ˆå¯†åº¦ãƒ™ãƒ¼ã‚¹ï¼‰

- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢**:
  - eps: 0.8, 1.0, 1.2, 1.4, 1.6
  - min_samples: 15, 20, 25, 30, 35

- **å®Ÿè¡Œçµæœ**:
  - ã‚¯ãƒ©ã‚¹ã‚¿æ•°: 137
  - ç·åˆã‚¹ã‚³ã‚¢: 64.66/100ï¼ˆæœ€é«˜ï¼‰
  - ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢: 0.5598

- **å•é¡Œç‚¹**: ã‚¯ãƒ©ã‚¹ã‚¿æ•°ãŒ137ã§é–¾å€¤50ã‚’è¶…é
- **Agenticåˆ¤æ–­**: æ¡ç”¨å€™è£œã‹ã‚‰é™¤å¤– â†’ HDBSCANèµ·å‹•

### 3. HDBSCANï¼ˆéšå±¤çš„DBSCANï¼‰âœ¨ Agenticãƒˆãƒªã‚¬ãƒ¼

- **èµ·å‹•æ¡ä»¶**: DBSCANã‚¯ãƒ©ã‚¹ã‚¿æ•° > 50
- **ç›®æ¨™**: ç´„50ã‚¯ãƒ©ã‚¹ã‚¿

- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢**:
  - min_cluster_size: 10, 15, 20, 30, 40
  - min_samples: 5, 8, 10
  - cluster_selection_method: 'eom' (Excess of Mass)

- **ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°**:
  ```python
  cluster_penalty = abs(n_clusters - target_clusters) / target_clusters
  noise_penalty = n_noise / len(labels)
  adjusted_score = score * (1 - cluster_penalty * 0.5) * (1 - noise_penalty * 0.3)
  ```

- **æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
  - min_cluster_size=20
  - min_samples=8

- **å®Ÿè¡Œçµæœ**:
  - ã‚¯ãƒ©ã‚¹ã‚¿æ•°: 52 âœ…ï¼ˆç›®æ¨™50ã«è¿‘ã„ï¼‰
  - ãƒã‚¤ã‚º: 1,565ä»¶ (36.5%)
  - ç·åˆã‚¹ã‚³ã‚¢: 49.04/100
  - ã‚·ãƒ«ã‚¨ãƒƒãƒˆã‚¹ã‚³ã‚¢: 0.2478

- **æ¡ç”¨ç†ç”±**: DBSCANãŒé™¤å¤–ã•ã‚ŒãŸãŸã‚ã€æœ€é«˜ã‚¹ã‚³ã‚¢ã§æ¡ç”¨

### æ‰‹æ³•æ¯”è¼ƒè¡¨ï¼ˆæœ€çµ‚ï¼‰

| é †ä½ | æ‰‹æ³• | ç·åˆã‚¹ã‚³ã‚¢ | ã‚·ãƒ«ã‚¨ãƒƒãƒˆ | DBæŒ‡æ•° | ã‚¯ãƒ©ã‚¹ã‚¿æ•° | å‚™è€ƒ |
|------|------|-----------|----------|--------|----------|------|
| ğŸ¥‡ | **HDBSCAN** | 49.04 | 0.248 | 1.271 | 52 | âœ… æ¡ç”¨ |
| ğŸ¥ˆ | KMeans | 43.95 | 0.162 | 1.584 | 27 | - |
| âŒ | DBSCAN | 64.66 | 0.560 | 0.549 | 137 | ã‚¯ãƒ©ã‚¹ã‚¿æ•°è¶…éã§é™¤å¤– |

---

## æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•

### 1. PCAï¼ˆåˆå›å®Ÿè¡Œï¼‰

- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: n_components=2
- **èª¬æ˜åˆ†æ•£**: 34.40%
- **ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚¹ã‚³ã‚¢**: 0.1879
- **åˆ¤å®š**: 0.1879 > 0.10 â†’ ä»£æ›¿æ‰‹æ³•è©¦è¡Œ

### 2. t-SNEï¼ˆä»£æ›¿æ‰‹æ³•ï¼‰

- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢**: perplexity=30, 50
- **æœ€é©å€¤**: perplexity=30
- **KL divergence**: 0.6992
- **ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚¹ã‚³ã‚¢**: 0.4897
- **è©•ä¾¡**: PCAã‚ˆã‚Šæ‚ªåŒ–

**å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹**:
```python
# scikit-learnãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§å¯¾å¿œ
try:
    tsne = TSNE(n_iter=1000, n_iter_without_progress=300)
except TypeError:
    tsne = TSNE(max_iter=1000, n_iter_without_progress=300)
```

### 3. UMAPï¼ˆä»£æ›¿æ‰‹æ³•ï¼‰âœ¨ æœ€é©

- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢**: n_neighbors=15, 30
- **æœ€é©å€¤**: n_neighbors=15
- **ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚¹ã‚³ã‚¢**: 0.1877 âœ…ï¼ˆæœ€è‰¯ï¼‰
- **æ¡ç”¨ç†ç”±**: 3æ‰‹æ³•ä¸­ã§æœ€å°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—

### æ¬¡å…ƒå‰Šæ¸›æ¯”è¼ƒè¡¨ï¼ˆæœ€çµ‚ï¼‰

| é †ä½ | æ‰‹æ³• | ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚¹ã‚³ã‚¢ | ã‚¯ãƒ©ã‚¹ã‚¿ä¸­å¿ƒé–“è·é›¢ | å‚™è€ƒ |
|------|------|-------------------|-----------------|------|
| ğŸ¥‡ | **UMAP** | 0.1877 | 11.64 | âœ… æ¡ç”¨ |
| ğŸ¥ˆ | PCA | 0.1879 | 2.40 | ã‚ãšã‹ã«åŠ£ã‚‹ |
| ğŸ¥‰ | t-SNE | 0.4897 | 65.52 | ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—å¤§ |

**UMAPã®å„ªä½æ€§**:
- ã‚¯ãƒ©ã‚¹ã‚¿é–“ã®é©åº¦ãªåˆ†é›¢
- å±€æ‰€æ§‹é€ ã¨å¤§åŸŸæ§‹é€ ã®ä¸¡æ–¹ã‚’ä¿æŒ
- è¨ˆç®—é€Ÿåº¦ãŒt-SNEã‚ˆã‚Šé«˜é€Ÿ

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### å¿…é ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
pip install pandas numpy scikit-learn matplotlib seaborn
pip install openpyxl  # Excelãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
pip install geopandas shapely pyproj  # åœ°ç†ç©ºé–“å‡¦ç†
pip install hdbscan  # éšå±¤çš„å¯†åº¦ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
pip install umap-learn  # æ¬¡å…ƒå‰Šæ¸›
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
pip install japanize-matplotlib  # æ—¥æœ¬èªè¡¨ç¤º
```

### å‹•ä½œç¢ºèªæ¸ˆã¿ç’°å¢ƒ

- Python: 3.11.9
- scikit-learn: 1.7.2ï¼ˆ1.4.0ã‹ã‚‰è‡ªå‹•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼‰
- geopandas: 1.1.1
- hdbscan: 0.8.40
- umap-learn: 0.5.9

---

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªå®Ÿè¡Œ

```bash
python run_all.py
```

å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®3ã‚¹ãƒ†ãƒƒãƒ—ãŒé †æ¬¡å®Ÿè¡Œã•ã‚Œã¾ã™:

1. **ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†**: 13ç‰¹å¾´é‡ã®æŠ½å‡º
2. **Agenticã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°**: è‡ªå‹•çš„ãªæ‰‹æ³•é¸æŠã¨å®Ÿè¡Œ
3. **çµæœã®å¯è¦–åŒ–**: æ•£å¸ƒå›³ã€ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã€ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆç­‰

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

```
output/
â”œâ”€â”€ processed_bridge_data.csv      # å‰å‡¦ç†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ cluster_results.csv            # ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°çµæœ
â”œâ”€â”€ cluster_summary.csv            # ã‚¯ãƒ©ã‚¹ã‚¿çµ±è¨ˆ
â”œâ”€â”€ agentic_improvement_log.txt    # æ”¹å–„å±¥æ­´ãƒ­ã‚°
â”œâ”€â”€ cluster_pca_scatter.png        # UMAPæ•£å¸ƒå›³
â”œâ”€â”€ cluster_heatmap.png            # ç‰¹å¾´é‡ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
â”œâ”€â”€ cluster_radar.png              # ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
â”œâ”€â”€ cluster_distribution.png       # ã‚¯ãƒ©ã‚¹ã‚¿åˆ†å¸ƒ
â”œâ”€â”€ feature_boxplots.png           # ç®±ã²ã’å›³
â””â”€â”€ cluster_report.txt             # åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
```

---

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆconfig.pyï¼‰

### ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```python
# ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹
BRIDGE_DATA_PATH = 'data/æ©‹æ¢ãƒ‡ãƒ¼ã‚¿.xlsx'
FISCAL_DATA_PATH = 'data/è²¡æ”¿åŠ›æŒ‡æ•°ãƒ‡ãƒ¼ã‚¿.xlsx'
POPULATION_DATA_PATH = 'data/äººå£çµ±è¨ˆãƒ‡ãƒ¼ã‚¿.xlsx'
RIVER_SHAPEFILE = 'data/RiverDataKokudo/.../W05-08_35-g_Stream.shp'
COASTLINE_SHAPEFILE = 'data/KaigansenDataKokudo/.../C23-06_35-g_Coastline.shp'

# ç‰¹å¾´é‡ãƒªã‚¹ãƒˆï¼ˆ13é …ç›®ï¼‰
FEATURE_COLUMNS = [
    'bridge_age', 'condition_score', 'maintenance_priority',
    'future_burden_ratio', 'aging_rate', 'fiscal_index',
    'structure_category', 'bridge_area', 'emergency_route',
    'overpass', 'repair_year_normalized',
    'under_river', 'distance_to_coast_km'  # åœ°ç†ç©ºé–“ç‰¹å¾´é‡
]

# Agenticãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
QUALITY_THRESHOLD = 60.0           # ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°å“è³ªé–¾å€¤
OVERLAP_THRESHOLD = 0.10           # ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—é–¾å€¤
DBSCAN_CLUSTER_THRESHOLD = 50      # DBSCANã‚¯ãƒ©ã‚¹ã‚¿æ•°é–¾å€¤
```

---

## å®Ÿè¡Œçµæœã®æ•™è¨“

### æˆåŠŸã—ãŸAgenticåˆ¤æ–­

1. **DBSCANé™¤å¤–åˆ¤æ–­**
   - 137ã‚¯ãƒ©ã‚¹ã‚¿ã¯è£œä¿®æ„æ€æ±ºå®šã«ä¸é©
   - è‡ªå‹•çš„ã«HDBSCANã‚’èµ·å‹•
   - çµæœ: 52ã‚¯ãƒ©ã‚¹ã‚¿ã®å®Ÿç”¨çš„ãªç²’åº¦ã‚’å®Ÿç¾

2. **HDBSCANè‡ªå‹•èµ·å‹•**
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢ã«ã‚ˆã‚Šç›®æ¨™50ã‚¯ãƒ©ã‚¹ã‚¿ã«è¿‘ã„çµæœ
   - ãƒã‚¤ã‚ºæ¯”ç‡ã¨ã‚¯ãƒ©ã‚¹ã‚¿æ•°ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æœ€é©åŒ–

3. **æ¬¡å…ƒå‰Šæ¸›ã®é©å¿œçš„é¸æŠ**
   - PCAã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ãŒé–¾å€¤è¶…é
   - t-SNE/UMAPã‚’è‡ªå‹•è©¦è¡Œ
   - UMAP ãŒæœ€è‰¯ã®åˆ†é›¢ã‚’å®Ÿç¾

### æŠ€è¡“çš„ãªå­¦ã³

1. **åœ°ç†ç©ºé–“å‡¦ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**
   - CRSï¼ˆåº§æ¨™å‚ç…§ç³»ï¼‰ã®æ˜ç¤ºçš„ãªç®¡ç†ãŒé‡è¦
   - UTMæŠ•å½±ã§ã®è·é›¢è¨ˆç®—ã®æ­£ç¢ºæ€§
   - Shapefile ã® CRS æœªè¨­å®šæ™‚ã®è‡ªå‹•è£œå®Œ

2. **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªäº’æ›æ€§**
   - scikit-learn ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã‚‹APIå¤‰æ›´ã¸ã®å¯¾å¿œ
   - t-SNE ã® `n_iter` vs `max_iter` å•é¡Œ
   - UMAP ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã‚ˆã‚‹ scikit-learn è‡ªå‹•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

3. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°**
   - HDBSCANã®`min_cluster_size`ã¯å°ã•ã‚ï¼ˆ10-40ï¼‰ãŒå®Ÿç”¨çš„
   - ãƒã‚¤ã‚ºãƒšãƒŠãƒ«ãƒ†ã‚£ã¨ã‚¯ãƒ©ã‚¹ã‚¿æ•°ãƒšãƒŠãƒ«ãƒ†ã‚£ã®ãƒãƒ©ãƒ³ã‚¹
   - ç›®æ¨™ã‚¯ãƒ©ã‚¹ã‚¿æ•°ã‹ã‚‰ã®ä¹–é›¢åº¦ã‚’è€ƒæ…®ã—ãŸã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°

### ä»Šå¾Œã®æ”¹å–„ç‚¹

1. **GMMå†è©•ä¾¡**
   - ç¾åœ¨ã¯ç„¡åŠ¹åŒ–ã—ã¦ã„ã‚‹ãŒã€ä¸€éƒ¨ãƒ‡ãƒ¼ã‚¿ã§ã¯æœ‰åŠ¹ãªå¯èƒ½æ€§
   - æ¡ä»¶ä»˜ãæœ‰åŠ¹åŒ–ã®æ¤œè¨

2. **ã‚¯ãƒ©ã‚¹ã‚¿è§£é‡ˆæ€§ã®å‘ä¸Š**
   - å„ã‚¯ãƒ©ã‚¹ã‚¿ã®ç‰¹æ€§ã‚’ã‚ˆã‚Šè©³ç´°ã«åˆ†æ
   - æ„æ€æ±ºå®šæ”¯æ´æƒ…å ±ã®å……å®Ÿ

3. **åœ°ç†ç©ºé–“ç‰¹å¾´é‡ã®æ‹¡å¼µ**
   - é“è·¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã®é–¢ä¿‚
   - ç½å®³ãƒªã‚¹ã‚¯åœ°åŸŸã¨ã®é‡ã­åˆã‚ã›
   - äº¤é€šé‡ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ

---

## Agenticãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è©³ç´°

### è‡ªå·±æ”¹å–„ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

```mermaid
graph LR
    A[å®Ÿè¡Œ] --> B[è©•ä¾¡]
    B --> C{æ”¹å–„å¿…è¦?}
    C -->|Yes| D[ä»£æ›¿æ‰‹æ³•è©¦è¡Œ]
    C -->|No| E[çµæœæ¡ç”¨]
    D --> B
    E --> F[ãƒ­ã‚°è¨˜éŒ²]
    
    style D fill:#f3e5f5,stroke:#4a148c
```

### æ”¹å–„å±¥æ­´ã®ä¾‹ï¼ˆå®Ÿè¡Œãƒ­ã‚°ï¼‰

```
1. ã€ãƒ©ã‚¦ãƒ³ãƒ‰1ã€‘åˆå›ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆKMeansï¼‰
2. ã€è©•ä¾¡1ã€‘ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°å“è³ªè©•ä¾¡
3. ã€ãƒ©ã‚¦ãƒ³ãƒ‰2ã€‘ä»£æ›¿ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã®è©¦è¡Œ
4. ã€é¸æŠã€‘æœ€é©ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã®æ±ºå®š
5. ğŸ¯ é¸æŠã•ã‚ŒãŸæ‰‹æ³•: HDBSCAN
6. ã€ãƒ©ã‚¦ãƒ³ãƒ‰1ã€‘åˆå›æ¬¡å…ƒå‰Šæ¸›ï¼ˆPCAï¼‰
7. ã€è©•ä¾¡2ã€‘æ¬¡å…ƒå‰Šæ¸›ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—è©•ä¾¡
8. ã€ãƒ©ã‚¦ãƒ³ãƒ‰2ã€‘ä»£æ›¿æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã®è©¦è¡Œ
9. ã€é¸æŠã€‘æœ€é©æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã®æ±ºå®š
10. ğŸ¯ æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•: UMAP
```

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
agentic-clustering/
â”œâ”€â”€ data/                          # ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ æ©‹æ¢ãƒ‡ãƒ¼ã‚¿.xlsx
â”‚   â”œâ”€â”€ è²¡æ”¿åŠ›æŒ‡æ•°ãƒ‡ãƒ¼ã‚¿.xlsx
â”‚   â”œâ”€â”€ äººå£çµ±è¨ˆãƒ‡ãƒ¼ã‚¿.xlsx
â”‚   â”œâ”€â”€ RiverDataKokudo/          # æ²³å·ãƒ‡ãƒ¼ã‚¿ï¼ˆShapefileï¼‰
â”‚   â””â”€â”€ KaigansenDataKokudo/      # æµ·å²¸ç·šãƒ‡ãƒ¼ã‚¿ï¼ˆShapefileï¼‰
â”œâ”€â”€ output/                        # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”œâ”€â”€ config.py                      # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ data_preprocessing.py          # ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
â”œâ”€â”€ agentic_workflow.py           # Agenticãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”œâ”€â”€ alternative_methods.py        # ä»£æ›¿æ‰‹æ³•ï¼ˆDBSCAN/HDBSCAN/t-SNE/UMAPï¼‰
â”œâ”€â”€ cluster_evaluator.py          # è©•ä¾¡æŒ‡æ¨™
â”œâ”€â”€ visualize_results.py          # å¯è¦–åŒ–
â”œâ”€â”€ run_all.py                    # ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ README_v05.md                 # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## å‚è€ƒæ–‡çŒ®

### ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•

- **DBSCAN**: Ester, M., et al. (1996). "A density-based algorithm for discovering clusters in large spatial databases with noise"
- **HDBSCAN**: Campello, R. J., et al. (2013). "Density-based clustering based on hierarchical density estimates"

### æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•

- **t-SNE**: van der Maaten, L., & Hinton, G. (2008). "Visualizing data using t-SNE"
- **UMAP**: McInnes, L., et al. (2018). "UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction"

### åœ°ç†ç©ºé–“å‡¦ç†

- å›½åœŸæ•°å€¤æƒ…å ±ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹: https://nlftp.mlit.go.jp/
- GeoPandas Documentation: https://geopandas.org/

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

## æ›´æ–°å±¥æ­´

### v0.5 (2025-11-24)

- âœ… åœ°ç†ç©ºé–“ç‰¹å¾´é‡ã®è¿½åŠ ï¼ˆæ¡ä¸‹æ²³å·ã€æµ·å²¸ç·šè·é›¢ï¼‰
- âœ… HDBSCANãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æœ€é©åŒ–ï¼ˆ52ã‚¯ãƒ©ã‚¹ã‚¿å®Ÿç¾ï¼‰
- âœ… DBSCANé™¤å¤–ãƒ«ãƒ¼ãƒ«ã®å®Ÿè£…
- âœ… GMMç„¡åŠ¹åŒ–ã«ã‚ˆã‚‹å‡¦ç†é«˜é€ŸåŒ–
- âœ… t-SNE/UMAPã®æ­£å¸¸å‹•ä½œåŒ–
- âœ… ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—é–¾å€¤ã®èª¿æ•´ï¼ˆ0.10ï¼‰
- âœ… Agenticãƒ•ãƒ­ãƒ¼å›³ã®è¿½åŠ ï¼ˆMermaidï¼‰

### v0.4 (ä»¥å‰)

- 11ç‰¹å¾´é‡ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- Agenticãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åŸºæœ¬å®Ÿè£…
- PCAæ¬¡å…ƒå‰Šæ¸›ã®å®Ÿè£…

---

## ãŠå•ã„åˆã‚ã›

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é–¢ã™ã‚‹ã”è³ªå•ã¯ã€GitHubã®Issuesã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
